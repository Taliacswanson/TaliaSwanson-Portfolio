---
title: "Presentation Exercise â€“ Halloween Candy"
format: html
---

# Halloween Candy Power Ranking 
For the presentation exercise, I chose to use the Halloween candy ranking set. 


## Original Graph from "FiveThirtyEight" Halloween Candy Power Ranking 
![](halloween_ranking.png){width=100%}

## Reproduced Graph for Halloween Candy Power Ranking
For this exercise I will recreate the graph given, however, I will leave all the rough draft codes that led to reproducing my graph. This is just to be able to see how certain changes, in code changed certain aspect of my recreated visual. 
```{r}

library(tidyverse)
library(here) 

# Load candy dataset using here()
candy <- read_csv(here("presentation-exercise", "candy-data.csv"))

# Quick look at the data
glimpse(candy)

```

```{r}

# Rank candies by win percentage
candy_ranked <- candy %>%
  arrange(desc(winpercent)) %>%
  mutate(competitorname = fct_reorder(competitorname, winpercent))

# Reproduce the horizontal bar chart
ggplot(candy_ranked, aes(x = winpercent, y = competitorname)) +
  geom_col(fill = "#F28E2B") +
  labs(
    title = "The Ultimate Halloween Candy Power Ranking",
    subtitle = "Win percentage based on head-to-head matchups",
    x = "Win Percentage",
    y = NULL
  ) +
  theme_minimal(base_size = 12)

```

 This coding gave me the general type of graph I was looking to recreate, however, it needs a lot of shaping of be publication ready. To adjust the spacing between categories (bars) in my Halloween candy graph, I asked an ChatGPT: "How do I increase or decrease the spacing between categories in a horizontal bar chart in ggplot2?" AI suggested changing the `width` parameter in `geom_col()` and explained that lower `width` values create more space between bars. After refinement in my code I was able to adjust the code this way below. 

```{r}

# Rank candies by percentages with row number
candy_ranked <- candy %>%
  arrange(desc(winpercent)) %>%
  mutate(
    RK = row_number(),
    competitorname = fct_reorder(competitorname, winpercent)
  )

# Horizontal bar chart with text and spacing
ggplot(candy_ranked, aes(x = winpercent, y = competitorname)) +
  geom_col(fill = "#F28E2B", width = 0.7) +  # adjust width for spacing
  geom_text(
    aes(label = round(winpercent, 1)),
    hjust = -0.1,
    size = 3.5
  ) +
  scale_x_continuous(limits = c(0, 90), expand = c(0, 0)) +
  labs(
    title = "The Ultimate Halloween Candy Power Ranking",
    x = NULL,
    y = NULL
  ) +
  theme_minimal() +
  theme(
    panel.grid.major.y = element_blank(),
    panel.grid.minor = element_blank(),
    axis.text.y = element_text(size = 9),
    axis.text.x = element_blank(),
    axis.ticks = element_blank(),
    plot.title = element_text(face = "bold", size = 14)
  )
 
```

Even with this prompt from AI, the recreated graph is having a figure size issue, so from there I tried to adjust the sizing and proportions of this graph and I adjusted the code to this. 

```{r fig.height=16, fig.width=10}
 
 ggplot(candy_ranked, aes(x = winpercent, y = competitorname)) +
  geom_col(fill = "#F28E2B", width = 0.7) +
  geom_text(
    aes(label = round(winpercent, 1)),
    hjust = -0.1,
    size = 3.5
  ) +
  scale_x_continuous(limits = c(0, 90), expand = c(0, 0)) +
  labs(
    title = "The Ultimate Halloween Candy Power Ranking",
    x = NULL,
    y = NULL
  ) +
  theme_minimal() +
  theme(
    panel.grid.major.y = element_blank(),
    panel.grid.minor = element_blank(),
    axis.text.y = element_text(size = 9),
    axis.text.x = element_blank(),
    axis.ticks = element_blank(),
    plot.title = element_text(face = "bold", size = 14)
  )
 
```

## Summary Table from "FiveThirtyEight" Halloween Candy Power Ranking 
This table is show the average win sahre based on candy type and categories based on the ranking

![](avg_win_share.png){width=100%}


## Summary Table: Avergae Win Share (reproduced)
```{r fig.height=10, fig.width=16}
library(ggplot2)
library(dplyr)

candy_summary <- tibble(
  candy_type = c("Chocolate","Fruit","Peanuts & nuts","Crispy", "Caramel","Nougat","Multi-piece","Candy bar","Hard candy"),
  avg_win = c(61,44,57,64,60,66,41,61,47),
  value_add = c(19.9,10.3,10.1,9.0,3.4,2.4,-0.2,-0.7,-4.9)
)

# positions for rows
candy_summary <- candy_summary %>%
  mutate(row = rev(row_number()))

ggplot(candy_summary) +

  # shaded value column
  geom_rect(aes(
    xmin = 2.6,
    xmax = 4.6,
    ymin = row - .45,
    ymax = row + .45,
    fill = value_add
  ),
  color = NA) +

  # candy type column
  geom_text(aes(x = 0, y = row, label = candy_type),
    hjust = 0,
    family = "serif",
    size = 6) +

  # avg win share column
  geom_text(aes(x = 2.2, y = row,
    label = ifelse(row == max(row),
      paste0(avg_win, "%"),
      avg_win)),
            hjust = 1,
            family = "serif",
            size = 6) +

  # value add numbers
  geom_text(aes(x = 2.7, y = row,
    label = sprintf("%+.1f", value_add)),
      hjust = 0,
      family = "serif",
      size = 6) +

  # teal to pink gradient
  scale_fill_gradient2(
    low = "#D9B0BC",
    mid = "#F0F0F0",
    high = "#4DA8A9",
    midpoint = 0
  ) +

  coord_cartesian(xlim = c(-0.1, 4.8)) +

  labs(title = NULL) +

  theme_void() +
  theme(
    legend.position = "none",
    plot.background = element_rect(fill = "white", color = NA)
  ) +

  # headers in the graph
  annotate("text", x = 0, y = max(candy_summary$row) + 1,
    label = "CANDY TYPE",
    family = "serif", fontface = "bold", size = 7, hjust = 0) +
  annotate("text", x = 2.2, y = max(candy_summary$row) + 1,
    label = "AVG. WIN SHARE",
    family = "serif", fontface = "bold", size = 7, hjust = 1) +
  annotate("text", x = 3.6, y = max(candy_summary$row) + 1,
    label = "VALUE ADD TO WIN %",
    family = "serif", fontface = "bold", size = 7, hjust = 0)
```

## Summary Table: Top 10 Halloween Candies (produced by me)
Moving forward, I wanted to a different create publication ready table. For my dataset I presented the top 10 halloween candies based on the dataset. This is not a reproduced table, instead, I decided to make a table. 

```{r}
library(dplyr)
library(gt)
library(scales)

# Top 10 candies by win percentage
top10 <- candy %>%
  arrange(desc(winpercent)) %>%
  slice(1:10) %>%
  mutate(
    Rank = row_number()
  ) %>%
  select(Rank, competitorname, winpercent)

# Calculate automatic summary statistic
mean_top10 <- mean(top10$winpercent)

# Create styled table
top10 %>%
  gt() %>%
  tab_header(
    title = md("**Top 10 Halloween Candies by Win Percentage**"),
    subtitle = "Ranked based on head-to-head matchup performance"
  ) %>%
  fmt_number(
    columns = winpercent,
    decimals = 1
  ) %>%
  data_color(
    columns = winpercent,
    colors = col_numeric(
      palette = c("#fde0dd", "#31a354"),
      domain = NULL
    )
  ) %>%
  cols_label(
    competitorname = "Candy",
    winpercent = "Win Percentage"
  ) %>%
  tab_source_note(
    source_note = md(
      paste0(
        "*Mean win percentage (Top 10):* **",
        round(mean_top10, 1),
        "%**"
      )
    )
  ) %>%
  tab_footnote(
    footnote = "Win percentage calculated from 85,000+ head-to-head candy matchups.",
    locations = cells_column_labels(columns = winpercent)
  )
```

